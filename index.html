<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gräsharnsspelen - Skicka poäng</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 600px; margin: auto; }
    input[type="number"] { width: 4rem; }
    table, th, td { border: 1px solid #000; border-collapse: collapse; }
    th, td { padding: 0.3rem; text-align: center; }
    button { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Skicka in resultat</h1>
  <label for="name">Spelarnamn:</label>
  <input type="text" id="name" required><br><br>

  <table>
    <thead>
      <tr><th colspan="9">Hål 1–9</th></tr>
    </thead>
    <tbody>
      <tr id="row1"></tr>
    </tbody>
  </table>
  <br>
  <table>
    <thead>
      <tr><th colspan="9">Hål 10–18</th></tr>
    </thead>
    <tbody>
      <tr id="row2"></tr>
    </tbody>
  </table>

  <button onclick="submitResult()">Skicka resultat</button>
  <p id="status"></p>

  <script>
    // Skapa 18 inputs för poäng
    const row1 = document.getElementById("row1");
    const row2 = document.getElementById("row2");
    for (let i = 1; i <= 18; i++) {
      const td = document.createElement("td");
      td.innerHTML = `<input type="number" id="hole${i}" min="1" max="3">`;
      (i <= 9 ? row1 : row2).appendChild(td);
    }

    async function submitResult() {
      const name = document.getElementById("name").value.trim();
      if (!name) return alert("Skriv in spelarens namn");

      const scores = [];
      for (let i = 1; i <= 18; i++) {
        const val = parseInt(document.getElementById(`hole${i}`).value);
        if (![1, 2, 3].includes(val)) {
          return alert(`Ogiltigt värde på hål ${i}`);
        }
        scores.push(val);
      }

      const spikar = scores.filter(p => p === 1).length;
      const total = scores.reduce((a, b) => a + b, 0);

      const payload = {
        spelare: name,
        poang: scores.join(","),
        spikar,
        total
      };

      const res = await fetch("https://xkvdvovunzukhwohozzh.supabase.co/rest/v1/poang", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrdmR2b3Z1bnp1a2h3b2hvenpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxMjA4MDcsImV4cCI6MjA2MTY5NjgwN30.M2V-TQUyYk09_bHfXbBdvXipRDw08GHz0JENnNCk6Ro",
          "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrdmR2b3Z1bnp1a2h3b2hvenpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxMjA4MDcsImV4cCI6MjA2MTY5NjgwN30.M2V-TQUyYk09_bHfXbBdvXipRDw08GHz0JENnNCk6Ro"
        },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        document.getElementById("status").textContent = "Resultat inskickat!";
      } else {
        document.getElementById("status").textContent = "Något gick fel.";
      }
    }
  </script>
</body>
</html>
